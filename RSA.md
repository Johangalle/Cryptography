# Asymmetric encryption (RSA)
Code snippets to learn cryptography without the need to use other libraries. DO NOT USE IN PRODUCTION.

RSA is the oldest asymmetric encryption (or public key) algorithm and is still used today. 

Prime numbers and factorisation into prime numbers is a major foundation of RSA. 

Factoring a number n = p*q (p and q being prime numbers) into the two factors p and q is a hard problem. 
Determining whether a given number is prime or not is easy (Miller-Rabin or other algorithms). Finding the least common multiple or the greatest common divisor of two numbers is also an easy problem (Euclidean algorithm).

The extended euclidean algorithm is used to calculate the multiplicative inverse. 

## Determining whether a given number is prime or not
```
>>> from cryptocourse import primes
>>> p = 2453
>>> primes.miller_rabin(p)
False
>>> p = 2457
>>> primes.miller_rabin(p)
False
>>> p = 2459
>>> primes.miller_rabin(p)
True
```
## Using the euclidean algorithm to find the greatest common divisor and the lowest common multiple
```
>>> from cryptocourse import euclidean
>>> n1 = 93353879449
>>> n2 = 2104755767
>>> a = euclidean.gcd(n1,n2)
>>> a
9511
>>> b = euclidean.lcm(n1,n2)
>>> b
20658933460425353
>>> n1*n2/b
9511.0
```
## Using the extended euclidean algorithm to find the multiplicative inverse
```
>>> from cryptocourse import euclidean
>>> euclidean.mulinv(5,17)  # What do we need to multiply 5 with in order to obtain 1 in modulo 17?
7
>>> 5*7%17    # % = remainder or modulo
1
```
## Determining suitable parameters for RSA (small number example)
```
>>> from cryptocourse import euclidean
>>> from cryptocourse import primes
>>> p = primes.findAPrime(30,100)
>>> q = primes.findAPrime(30,100)
>>> n = p*q
>>> p, q, n
(31, 79, 2449)
>>> totient_n = (p-1)*(q-1)
>>> e = 3
>>> d = euclidean.mulinv(e, totient_n)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/Users/johangalle/Public/Sources/cryptocourse2/euclidean.py", line 67, in mulinv
    raise ValueError('multiplicative inverse is not possible if values are not relatively prime ')
ValueError: multiplicative inverse is not possible if values are not relatively prime 
>>> e = 5
>>> d = euclidean.mulinv(e, totient_n)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/Users/johangalle/Public/Sources/cryptocourse2/euclidean.py", line 67, in mulinv
    raise ValueError('multiplicative inverse is not possible if values are not relatively prime ')
ValueError: multiplicative inverse is not possible if values are not relatively prime 
>>> e = 7
>>> d = euclidean.mulinv(e, totient_n)
>>> plain = 1234    # should be smaller than n
>>> cipher = pow(plain,e,n)
>>> cipher
2288
>>> decrypt = pow(cipher,d,n)
>>> decrypt
1234
>>> public = (n,e)
>>> private = (n,d)
>>> 
>>> totient_n/3
780.0
>>> totient_n/5
468.0
>>> totient_n/7
334.2857142857143
```
## Using Fermat factorization to factor n
See [Fermat Attack on RSA](https://fermatattack.secvuln.info). The attack only works if the difference between p and q is relatively small. If we have primes of 2048 bit length, and the distance between the two primes is half (2^1024), then the attack is immediate. If it is slightly more (say 1033 or 1034), it still produces a result after a reasonable time.
```
>>> from cryptocourse import primes
>>> p = primes.findAPrime(pow(2,2047),pow(2,2048))
>>> q = primes.findAPrime(p, p+pow(2,1030))
>>> d = p-q
>>> d.bit_length()
1030
>>> from cryptocourse import rsa_square_attack
>>> rsa_square_attack.factor(n)
(27510374069082399769043346522901546909411217671944577705833991378951817333288679633778663731322198982250576232408360712323536170531183933004397974648527787883448098293223733989303334184107518483002408699938558031081246822727804926924033314597269134091328936928012953306900662028233743976866530335603802607405165796701566105471295095442843019050471979184344106222902721523156683643193822412278286047205322776348110541527618776788407153202834624364805618021470479425160593888466755108695983666249751684529640238419893190424253509251270098125457080360418817185768963861777957641122756582944280105820045724211145137005841, 27510374069082399769043346522901546909411217671944577705833991378951817333288679633778663731322198982250576232408360712323536170531183933004397974648527787883448098293223733989303334184107518483002408699938558031081246822727804926924033314597269134091328936928012953306900662028233743976866530335603802607413962481724974770211458556125346789744227855259272058131741764491901212418755148821237189049785773692466599492489584861884711899548278585022865108229475162136567012512951075754399836909258115084192370733666301467698474955697973179901382819569270249129528521299906330651665569616685158159857603480370038091100299)
>>> p,q
(27510374069082399769043346522901546909411217671944577705833991378951817333288679633778663731322198982250576232408360712323536170531183933004397974648527787883448098293223733989303334184107518483002408699938558031081246822727804926924033314597269134091328936928012953306900662028233743976866530335603802607405165796701566105471295095442843019050471979184344106222902721523156683643193822412278286047205322776348110541527618776788407153202834624364805618021470479425160593888466755108695983666249751684529640238419893190424253509251270098125457080360418817185768963861777957641122756582944280105820045724211145137005841, 27510374069082399769043346522901546909411217671944577705833991378951817333288679633778663731322198982250576232408360712323536170531183933004397974648527787883448098293223733989303334184107518483002408699938558031081246822727804926924033314597269134091328936928012953306900662028233743976866530335603802607413962481724974770211458556125346789744227855259272058131741764491901212418755148821237189049785773692466599492489584861884711899548278585022865108229475162136567012512951075754399836909258115084192370733666301467698474955697973179901382819569270249129528521299906330651665569616685158159857603480370038091100299)
>>> q = primes.findAPrime(p, p+pow(2,1034))
>>> d = p-q
>>> d.bit_length()
1033
>>> n = p*q
>>> rsa_square_attack.factor(n)
(27510374069082399769043346522901546909411217671944577705833991378951817333288679633778663731322198982250576232408360712323536170531183933004397974648527787883448098293223733989303334184107518483002408699938558031081246822727804926924033314597269134091328936928012953306900662028233743976866530335603802607405165796701566105471295095442843019050471979184344106222902721523156683643193822412278286047205322776348110541527618776788407153202834624364805618021470479425160593888466755108695983666249751684529640238419893190424253509251270098125457080360418817185768963861777957641122756582944280105820045724211145137005841, 27510374069082399769043346522901546909411217671944577705833991378951817333288679633778663731322198982250576232408360712323536170531183933004397974648527787883448098293223733989303334184107518483002408699938558031081246822727804926924033314597269134091328936928012953306900662028233743976866530335603802607486657148954146316483783084517350481249698269212296825732749001171002344891714630071807885543213555190517272683141770728296730745591507525474235877026431906535003206750426118874106817698182636640872062455140991651496649893841655875257544680565115524969575678832019994716673511945949229877685965179220095678649519)
>>> p,q
(27510374069082399769043346522901546909411217671944577705833991378951817333288679633778663731322198982250576232408360712323536170531183933004397974648527787883448098293223733989303334184107518483002408699938558031081246822727804926924033314597269134091328936928012953306900662028233743976866530335603802607405165796701566105471295095442843019050471979184344106222902721523156683643193822412278286047205322776348110541527618776788407153202834624364805618021470479425160593888466755108695983666249751684529640238419893190424253509251270098125457080360418817185768963861777957641122756582944280105820045724211145137005841, 27510374069082399769043346522901546909411217671944577705833991378951817333288679633778663731322198982250576232408360712323536170531183933004397974648527787883448098293223733989303334184107518483002408699938558031081246822727804926924033314597269134091328936928012953306900662028233743976866530335603802607486657148954146316483783084517350481249698269212296825732749001171002344891714630071807885543213555190517272683141770728296730745591507525474235877026431906535003206750426118874106817698182636640872062455140991651496649893841655875257544680565115524969575678832019994716673511945949229877685965179220095678649519)
>>> 
```

